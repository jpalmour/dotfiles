#!/bin/bash
# macOS system preferences configuration
# Inspired by: https://github.com/mathiasbynens/dotfiles/blob/main/.macos

set -eufo pipefail

echo "Configuring macOS system preferences..."

###############################################################################
# Finder                                                                      #
###############################################################################

# Finder: show hidden files by default
defaults write com.apple.finder AppleShowAllFiles -bool true

# Finder: show all filename extensions
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Finder: show status bar
defaults write com.apple.finder ShowStatusBar -bool true

# Finder: show path bar
defaults write com.apple.finder ShowPathbar -bool true

# Display full POSIX path as Finder window title
defaults write com.apple.finder _FXShowPosixPathInTitle -bool true

# Disable the warning when changing a file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

###############################################################################
# Dock & Dashboard                                                            #
###############################################################################

# Don't automatically rearrange Spaces based on most recent use
defaults write com.apple.dock mru-spaces -bool false

###############################################################################
# Apply changes                                                               #
###############################################################################

echo "Killing affected applications (to apply changes)..."

# Kill affected applications
for app in "Finder" "Dock"; do
  killall "${app}" &> /dev/null || true
done

echo "âœ… macOS preferences configured. Note that some changes require logout/restart to take full effect."
