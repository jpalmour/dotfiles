{{- if or (and .is_wsl (lookPath "op.exe")) (and (not .is_wsl) (lookPath "op")) }}
[gpg]
    format = ssh

[gpg "ssh"]
    {{- if eq .chezmoi.os "darwin" }}
    program = /Applications/1Password.app/Contents/MacOS/op-ssh-sign
    {{- else if eq .chezmoi.os "linux" }}
    {{-   if .is_wsl }}
    program = op-ssh-sign.exe
    {{-   else }}
    program = /opt/1Password/op-ssh-sign
    {{-   end }}
    {{- else if eq .chezmoi.os "windows" }}
    program = op-ssh-sign.exe
    {{- else }}
    ssh.program = op-ssh-sign
    {{- end }}

[commit]
    gpgSign = true

[user]
    {{- if .is_wsl -}}
    signingkey = {{ output "op.exe" "read" "--no-newline" "op://Private/Dev SSH Key/public_key" }}
    {{- else -}}
    signingkey = {{ onepasswordRead "op://Private/Dev SSH Key/public_key" }}
    {{- end }}
{{- else }}
# 1Password CLI not installed - signing config will be available after 1Password is configured
{{- end }}

{{- if eq .chezmoi.os "windows" }}
# Use Microsoft OpenSSH so 1Passwordâ€™s agent works smoothly
[core]
    sshCommand = C:\\Windows\\System32\\OpenSSH\\ssh.exe
{{- end }}

[user]
    name = Joseph Palmour
    email = {{ if and .is_work_machine (ne .work_email ``) -}}{{ .work_email }}{{- else -}}{{ .personal_email }}{{- end }}
