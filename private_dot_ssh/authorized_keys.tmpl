{{- if lookPath "op" }}
  {{- /* Check for item existence without failing the template. */}}
  {{- $status := "" -}}
  {{- if eq .chezmoi.os "windows" -}}
    {{- $status = (output "powershell" "-NoProfile" "-Command" "if (op item get \"Dev SSH Key\" --fields \"public key\" *> $null) { 'present' } else { 'missing' }") -}}
  {{- else -}}
    {{- $status = (trim (output "sh" "-c" "command -v op >/dev/null 2>&1 && op item get 'Dev SSH Key' --format json >/dev/null 2>&1 && echo present || echo missing")) -}}
  {{- end -}}
  {{- if eq $status "present" -}}
    {{- $sshItem := onepasswordItemFields "Dev SSH Key" -}}
    {{- $pub := index $sshItem "Public Key" -}}
    {{- if $pub -}}
{{ $pub }}
    {{- else -}}
# 1Password item 'Dev SSH Key' found but missing 'Public Key' field; skipping for now.
    {{- end -}}
  {{- else -}}
# 1Password CLI present but item 'Dev SSH Key' not found; skipping for now.
  {{- end -}}
{{- else }}
# 1Password CLI not yet installed - authorized keys will be configured after setup
{{- end }}
