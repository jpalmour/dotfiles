# Global defaults
Host *
  ServerAliveInterval 60
  ServerAliveCountMax 2
{{- if eq .chezmoi.os "darwin" }}
  UseKeychain yes
  IdentityAgent ~/.1password/agent.sock
{{- else if eq .chezmoi.os "linux" }}
  IdentityAgent ~/.1password/agent.sock
{{- end }}
  # ForwardAgent can be handy if you hop hosts, but keep it off unless needed:
  # ForwardAgent no
  # StrictHostKeyChecking ask

# --- Private host blocks from 1Password ---
{{- if lookPath "op" }}
{{- $hostsItemTitle := "ssh-hosts" -}}
{{- /* Check for item existence without failing the template. */}}
{{- $status := "" -}}
{{- if eq .chezmoi.os "windows" -}}
  {{- $status = (output "powershell" "-NoProfile" "-Command" "if (op item get \"ssh-hosts\" --fields \"hosts\" *> $null) { 'present' } else { 'missing' }") -}}
{{- else -}}
  {{- $status = (trim (output "sh" "-c" "command -v op >/dev/null 2>&1 && op item get 'ssh-hosts' --format json >/dev/null 2>&1 && echo present || echo missing")) -}}
{{- end -}}
{{- if eq $status "present" -}}
  {{- $hostsItem := onepasswordItemFields $hostsItemTitle -}}
  {{- $hosts := index $hostsItem "hosts" -}}
  {{- if not $hosts }}
# âš ï¸  1Password item 'ssh-hosts' found but has no 'hosts' field
# ğŸ“š See 1PASS_SETUP.md for field format examples
  {{- else }}
{{ $hosts | indent 0 }}
  {{- end }}
{{- else }}
# 1Password CLI present but item 'ssh-hosts' not found; skipping host blocks for now.
# ğŸ“š To create:
#   op item create --category "Secure Note" --title "ssh-hosts" "hosts=..."
# ğŸ” Verify:
#   op item get "ssh-hosts" --fields "hosts"
{{- end }}
{{- else }}
# 1Password CLI not yet installed - host configs will be added after setup
{{- end }}
